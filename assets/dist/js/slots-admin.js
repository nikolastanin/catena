var a={init:function(){this.bindEvents(),this.initComponents()},bindEvents:function(){document.addEventListener("change",function(t){t.target.matches(".slots-meta-field input, .slots-meta-field select")&&a.handleMetaFieldChange(t.target)}),document.addEventListener("click",function(t){if(t.target.matches(".quick-edit-slot")){t.preventDefault();var e=t.target.dataset.slotId;a.openQuickEdit(e)}}),document.addEventListener("change",function(t){t.target.matches("#bulk-action-selector-top, #bulk-action-selector-bottom")&&a.handleBulkActionChange(t.target)}),document.addEventListener("change",function(t){t.target.matches('.slots-settings-field input[type="checkbox"]')&&a.handleSettingChange(t.target)}),document.addEventListener("click",function(t){t.target.matches(".refresh-slots-stats")&&(t.preventDefault(),a.refreshStats())}),document.addEventListener("change",function(t){t.target.matches(".slots-filter select")&&a.filterSlots(t.target)}),document.addEventListener("focus",function(t){t.target.matches(".slots-date-picker")&&!t.target.classList.contains("ui-datepicker")&&a.initDatePicker(t.target)})},initComponents:function(){this.initTooltips(),this.initSortableTables(),this.initColorPickers()},handleMetaFieldChange:function(t){var e=t.name,n=t.value,o=document.getElementById("post_ID")?document.getElementById("post_ID").value:"";this.autoSaveMetaField(o,e,n),this.updateRelatedFields(e,n)},autoSaveMetaField:function(t,e,n){var o=new XMLHttpRequest;o.open("POST",ajaxurl,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){if(o.status===200)try{var s=JSON.parse(o.responseText);s.success&&a.showNotice("Field updated successfully.","success")}catch(c){a.showNotice("Failed to update field.","error")}else a.showNotice("Failed to update field.","error")},o.onerror=function(){a.showNotice("Failed to update field.","error")};var i="action=slots_auto_save_meta&post_id="+encodeURIComponent(t)+"&field_name="+encodeURIComponent(e)+"&field_value="+encodeURIComponent(n)+"&nonce="+encodeURIComponent(slots_admin.nonce);o.send(i)},updateRelatedFields:function(t,e){t==="_slot_time"&&this.calculateDuration(e),t==="_slot_available"&&this.updateStatusIndicator(e)},calculateDuration:function(t){var e=document.querySelector('input[name="_slot_duration"]');e&&t&&(e.value="60")},updateStatusIndicator:function(t){var e=document.querySelector(".slots-status-indicator");e&&(t==="1"?(e.classList.remove("booked"),e.classList.add("available"),e.textContent="Available"):(e.classList.remove("available"),e.classList.add("booked"),e.textContent="Booked"))},openQuickEdit:function(t){var e=new XMLHttpRequest;e.open("POST",ajaxurl,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onload=function(){if(e.status===200)try{var o=JSON.parse(e.responseText);o.success&&a.populateQuickEditForm(o.data)}catch(i){}};var n="action=slots_get_slot_data&slot_id="+encodeURIComponent(t)+"&nonce="+encodeURIComponent(slots_admin.nonce);e.send(n)},populateQuickEditForm:function(t){var e=document.getElementById("quick-edit-slot-time"),n=document.getElementById("quick-edit-slot-duration"),o=document.getElementById("quick-edit-slot-status"),i=document.getElementById("quick-edit-slot-form");e&&(e.value=t.time),n&&(n.value=t.duration),o&&(o.value=t.status),i&&(i.style.display="block")},handleBulkActionChange:function(t){var e=t.value,n=t.closest(".tablenav").querySelector(".button");e&&e!=="-1"?n.disabled=!1:n.disabled=!0},handleSettingChange:function(t){var e=t.name,n=t.checked?"1":"0";this.autoSaveSetting(e,n)},autoSaveSetting:function(t,e){var n=new XMLHttpRequest;n.open("POST",ajaxurl,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=function(){if(n.status===200)try{var i=JSON.parse(n.responseText);i.success&&a.showNotice("Setting updated successfully.","success")}catch(s){}};var o="action=slots_auto_save_setting&setting_name="+encodeURIComponent(t)+"&setting_value="+encodeURIComponent(e)+"&nonce="+encodeURIComponent(slots_admin.nonce);n.send(o)},refreshStats:function(){document.querySelector(".slots-stats-grid");var t=document.querySelector(".refresh-slots-stats");t&&(t.disabled=!0,t.textContent="Refreshing...");var e=new XMLHttpRequest;e.open("POST",ajaxurl,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onload=function(){if(e.status===200)try{var o=JSON.parse(e.responseText);o.success&&(a.updateStatsDisplay(o.data),a.showNotice("Statistics updated successfully.","success"))}catch(i){a.showNotice("Failed to refresh statistics.","error")}else a.showNotice("Failed to refresh statistics.","error");t&&(t.disabled=!1,t.textContent="Refresh Stats")},e.onerror=function(){a.showNotice("Failed to refresh statistics.","error"),t&&(t.disabled=!1,t.textContent="Refresh Stats")};var n="action=slots_refresh_stats&nonce="+encodeURIComponent(slots_admin.nonce);e.send(n)},updateStatsDisplay:function(t){var e=document.querySelectorAll(".slots-stat-card");e.forEach(function(n){var o=n.querySelector("h3"),i=n.querySelector(".stat-number");if(o&&i){var s=o.textContent.toLowerCase().replace(/\s+/g,"_");t[s]!==void 0&&(i.textContent=t[s])}})},filterSlots:function(t){var e=t.value,n=t.dataset.filterType,o=new URL(window.location);o.searchParams.set(n,e),window.location.href=o.toString()},initDatePicker:function(t){typeof t.datepicker=="function"?t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-10:+10",showButtonPanel:!0,closeText:"Close",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"]}):t.type="date"},initTooltips:function(){var t=document.querySelectorAll("[data-tooltip]");t.forEach(function(e){typeof e.tooltip=="function"?e.tooltip({position:{my:"left+5 center",at:"right center"},show:{effect:"fadeIn",duration:200},hide:{effect:"fadeOut",duration:200}}):e.title=e.dataset.tooltip})},initSortableTables:function(){var t=document.querySelectorAll(".slots-sortable-table");t.forEach(function(e){typeof e.tablesorter=="function"&&e.tablesorter({sortList:[[0,0]],headers:{0:{sorter:"text"},1:{sorter:"text"},2:{sorter:"text"},3:{sorter:"text"}}})})},initColorPickers:function(){var t=document.querySelectorAll(".slots-color-picker");t.forEach(function(e){typeof e.wpColorPicker=="function"&&e.wpColorPicker()})},showNotice:function(t,e){var n="notice notice-"+e,o='<div class="'+n+' is-dismissible"><p>'+t+"</p></div>",i=document.querySelectorAll(".slots-notice");i.forEach(function(u){u.remove()});var s=document.querySelector(".wrap h1");if(s){var c=document.createElement("div");c.innerHTML=o;var r=c.firstElementChild;r.classList.add("slots-notice"),s.parentNode.insertBefore(r,s.nextSibling),setTimeout(function(){r&&r.parentNode&&(r.style.opacity="0",r.style.transition="opacity 0.5s",setTimeout(function(){r&&r.parentNode&&r.remove()},500))},5e3)}},formatDate:function(t){var e=new Date(t);return e.toLocaleDateString()},formatTime:function(t){return t},validateTimeFormat:function(t){var e=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;return e.test(t)},validateDuration:function(t){return!isNaN(t)&&t>0&&t<=1440}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){a.init()}):a.init();window.SlotsAdmin=a;
